<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/js/jquery.min.js"></script>
    <link rel="stylesheet" href="/js/layui/css/layui.css">
    <script src="/js/layui/layui.js"></script>
    <script src="/ckplayer/ckplayer.js"></script>
    <script src="/ckplayer/ck.js"></script>

</head>
<body>
<!--style="width:100%;height:100%;"-->
        <div id="video" style="width: 600px;height: 300px" ></div>
<h2>评价</h2> <a href="javascript:fanye(1)" data-page="2">上一页</a>
第 &nbsp<input id="yeshu" style="width: 40px;height: 30px;text-align: center" value="1">页
&nbsp;每页<select id="rows" style="width: 40px;height: 30px;">
    <option value="5">5
    <option value="10">10
</select>条
<a href="javascript:fanye(2)" data-page="2">下一页</a>
<hr width="100%"  style="color: #9F9F9F"/>
<form class="layui-form" id="commentsform">
    <input type="hidden" id="videoid" name="videoid">
    <div class="layui-form-item">
        <label class="layui-form-label">评论星</label>
        <div class="layui-input-inline">
            <div id="test3"></div>
        </div>
        <div class="layui-input-inline">
            <input type="hidden" name="commentGrade" id="yin" width="30%" autocomplete="off" class="layui-input"  />
        </div>
    </div>


    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">评论内容</label>
        <div class="layui-input-block">
            <textarea name="commentContent" placeholder="请输入内容" id="commentContent"  style="width: 100px;height: 100px" class="layui-textarea"></textarea>
        </div>

    </div>


    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="formDemo" type="button" onclick="addcomments()">保存</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>
<script  th:inline="javascript">
    function addcomments() {
        layedit.sync(content);
        $("#videoid").val([[${id}]]);
        var data=$("#commentsform").serialize();
        alert(data);
        $.ajax({
            url:"/addComment",
            type:"post",
            data:data,
            success:function () {
                layer.msg("评论成功");
            },error:function () {
                layer.msg("网络错误，评论失败");
            }
        });
    }

    var videoObject = {
        container: '#video',//“#”代表容器的ID，“.”或“”代表容器的class
        variable: 'player',//该属性必需设置，值等于下面的new chplayer()的对象
      //  flashplayer:false,//如果强制使用flashplayer则设置成true
        allowFullScreen:true,//是否支持全屏
        //poster:"/img/1.jpg",
        video:{
            file:[[${url}]],//视频地址
            type:'video/mp4',

        },
        advertisements:'website:{"front":[{  "file": "/img/2.jpg", "type": "jpg", "link": "http://www.ckplayer.com", "time": 15  }]}'
    };

    var player=new ckplayer(videoObject);
$(function () {
    queryComments(1);
});
    var bb='';
    function queryComments(page) {
        var videoid=[[${id}]];
        $.ajax({
            url:"/jgy/queryComments",
            type:"post",
            dat:{
                videoid:videoid,
                page:page,
                rows:$("#rows").val()
            },
            success:function (data) {
              bb=data.length;
            },error:function () {

            }
        });
    }

    /*分页*/
    function fanye(type){
        var a=parseInt($("#yeshu").val());
        var b=Math.ceil(parseInt(bb)/pageSize);
        if(type==1) {
            if (a == 1) {
                layer.msg("已经是首页");
            } else {
                $("#yeshu").val(a-1);
                queryComments($("#yeshu").val());
            }
        }
        if (type == 2) {
            if (a == b) {
                layer.msg("已经是尾页");
            } else {
                $("#yeshu").val(a+1);
                queryComments($("#yeshu").val());
            }
        }
    }
    var layedit=null;
    var content=null;
    var layer=   layui.layer;
    layui.use(['layer','layedit','rate'], function(){
         layedit = layui.layedit;
         content= layedit.build('commentContent'); //建立编辑器
        var rate = layui.rate;
        //半星效果
        rate.render({
            elem: '#test3'
            ,value: 0 //初始值
            ,half: true //开启半星
            ,length: 5   //星星个数
            ,choose: function(value){
                $("#yin").val(value);
            }
        })
    });
    var layer = layui.layer;
</script>

</body>

</html>